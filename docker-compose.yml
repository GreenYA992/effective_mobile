version: '3.8'

services:
  tests:
    build: .
    container_name: saucedemo-tests
    volumes:
      # Монтируем папки для результатов тестов
      - ./allure-report:/app/allure-report
      # Для разработки
      - ./pages:/app/pages
      - ./tests:/app/tests
      - ./utils:/app/utils
      - ./conftest.py:/app/conftest.py
    environment:
      - DOCKER_MODE=true
    command: >
      sh -c "echo 'Запуск тестов...' &&
             pytest tests/ -m docker -n auto --alluredir=/tmp/allure-results --tb=short &&
             echo 'Генерация отчета Allure...' &&
             allure generate /tmp/allure-results -o ./allure-report --clean &&
             echo 'Тесты завершены! Отчет в папке allure-report'"
    # Очищаем контейнер после выполнения
    restart: "no"